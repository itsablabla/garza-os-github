# GARZA OS Services Registry
# Last Updated: 2025-12-27
# All services across infrastructure with health checks and metadata

services:
  
  # MCP Servers
  garza-home-mcp:
    type: "mcp_server"
    platform: "fly.io"
    host: "garza-home-mcp.fly.dev"
    purpose: "Home automation, Bible tools, messaging"
    health_check:
      method: "http"
      url: "https://garza-home-mcp.fly.dev/health"
      expected_status: 200
      expected_body_contains: "ok"
      timeout: 5
      interval: 300
    dependencies: []
    critical: true

  lrlab-mcp:
    type: "mcp_server"
    platform: "fly.io"
    host: "lrlab-mcp.fly.dev"
    purpose: "Dev tools - GitHub, Fly, DNS, n8n, Scout"
    health_check:
      method: "http"
      url: "https://lrlab-mcp.fly.dev/health"
      expected_status: 200
      timeout: 5
      interval: 300
    dependencies: []
    critical: true

  cf-mcp:
    type: "mcp_server"
    platform: "local_mac"
    host: "ssh.garzahive.com"
    purpose: "Brain - orchestration, SSH gateway"
    health_check:
      method: "http"
      url: "https://mcp-cf.garzahive.com/health"
      expected_status: 200
      timeout: 10
      interval: 300
    dependencies: []
    critical: true
    notes: "Running on Boulder Mac Mini"

  stagehand-mcp:
    type: "mcp_server"
    platform: "fly.io"
    host: "stagehand-mcp.fly.dev"
    purpose: "Browser automation (Playwright)"
    health_check:
      method: "http"
      url: "https://stagehand-mcp.fly.dev/health"
      expected_status: 200
      timeout: 5
      interval: 300
    dependencies: []
    critical: false

  # Voice Pipeline
  garza-ears:
    type: "service"
    platform: "fly.io"
    host: "garza-ears.fly.dev"
    purpose: "Voice memo transcription (Whisper + Claude)"
    health_check:
      method: "http"
      url: "https://garza-ears.fly.dev/health"
      expected_status: 200
      timeout: 10
      interval: 300
    dependencies: []
    critical: true

  # Workflow Automation
  garza-n8n:
    type: "workflow_engine"
    platform: "fly.io"
    host: "garza-n8n.fly.dev"
    purpose: "Self-hosted n8n workflows"
    health_check:
      method: "http"
      url: "https://garza-n8n.fly.dev/healthz"
      expected_status: 200
      timeout: 5
      interval: 300
    dependencies: []
    critical: false

  # Cloudflare Workers
  voicenotes-webhook:
    type: "edge_function"
    platform: "cloudflare_workers"
    host: "voicenotes-webhook.jadengarza.workers.dev"
    purpose: "VoiceNotes sync - pulls transcripts to KV"
    health_check:
      method: "http"
      url: "https://voicenotes-webhook.jadengarza.workers.dev/health"
      expected_status: 200
      timeout: 3
      interval: 600
    dependencies: []
    critical: false

  voicenotes-indexer:
    type: "edge_function"
    platform: "cloudflare_workers"
    host: "voicenotes-indexer.jadengarza.workers.dev"
    purpose: "Entity extraction from voice memos"
    health_check:
      method: "http"
      url: "https://voicenotes-indexer.jadengarza.workers.dev/health"
      expected_status: 200
      timeout: 3
      interval: 600
    dependencies:
      - "voicenotes-webhook"
    critical: false

  jessica-cron:
    type: "edge_function"
    platform: "cloudflare_workers"
    host: "jessica-cron.garzahive.workers.dev"
    purpose: "Automated Jessica messages"
    health_check:
      method: "http"
      url: "https://jessica-cron.garzahive.workers.dev/health"
      expected_status: 200
      timeout: 3
      interval: 600
    dependencies: []
    critical: false

  # Home Automation Stack
  home-assistant:
    type: "home_automation"
    platform: "docker"
    host: "boulder"
    purpose: "Home automation hub"
    health_check:
      method: "ssh_command"
      host: "boulder"
      command: "docker ps | grep homeassistant | wc -l"
      expected_output: "1"
      timeout: 10
      interval: 600
    dependencies: []
    critical: false

  mosquitto-mqtt:
    type: "message_broker"
    platform: "docker"
    host: "boulder"
    purpose: "MQTT broker for home automation"
    health_check:
      method: "ssh_command"
      host: "boulder"
      command: "docker ps | grep mosquitto | wc -l"
      expected_output: "1"
      timeout: 10
      interval: 600
    dependencies: []
    critical: false

  # Computer Use Containers
  computer-use-1:
    type: "browser_automation"
    platform: "docker"
    host: "mac"
    purpose: "Claude Computer Use instance 1"
    health_check:
      method: "http"
      url: "https://computer1.garzahive.com/health"
      expected_status: 200
      timeout: 10
      interval: 600
    dependencies:
      - "cf-mcp"
    critical: false

  computer-use-2:
    type: "browser_automation"
    platform: "docker"
    host: "mac"
    purpose: "Claude Computer Use instance 2"
    health_check:
      method: "http"
      url: "https://computer2.garzahive.com/health"
      expected_status: 200
      timeout: 10
      interval: 600
    dependencies:
      - "cf-mcp"
    critical: false

  # Infrastructure
  octelium-gateway:
    type: "zero_trust_gateway"
    platform: "vps"
    host: "octelium"
    purpose: "Zero trust access gateway"
    health_check:
      method: "ssh_command"
      host: "octelium"
      command: "systemctl is-active cloudflared"
      expected_output: "active"
      timeout: 10
      interval: 300
    dependencies: []
    critical: true

# Service Groups
service_groups:
  mcp_core:
    - "garza-home-mcp"
    - "lrlab-mcp"
    - "cf-mcp"
    description: "Core MCP servers - must be operational"
    
  voice_pipeline:
    - "garza-ears"
    - "voicenotes-webhook"
    - "voicenotes-indexer"
    description: "Voice memo intelligence pipeline"
    
  home_automation:
    - "home-assistant"
    - "mosquitto-mqtt"
    - "garza-home-mcp"
    description: "Home automation stack"
    
  browser_automation:
    - "computer-use-1"
    - "computer-use-2"
    - "stagehand-mcp"
    description: "Browser/computer control"

# Health Check Schedule
health_check_config:
  critical_services_interval: 300  # 5 minutes
  non_critical_interval: 600       # 10 minutes
  retry_attempts: 3
  retry_delay: 5
  alert_on_failure_count: 2        # Alert after 2 consecutive failures
  auto_restart_enabled: false      # Manual for now
