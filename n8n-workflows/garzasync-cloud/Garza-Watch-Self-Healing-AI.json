{"updatedAt":"2025-12-26T02:21:24.121Z","createdAt":"2025-12-26T00:00:33.300Z","id":"ScSmqCrvcDOkGVjM","name":"Garza Watch - Self-Healing AI","description":null,"active":true,"isArchived":false,"nodes":[{"parameters":{"rule":{"interval":[{"field":"minutes","minutesInterval":30}]}},"id":"schedule","name":"Every 30min","type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[200,300]},{"parameters":{"httpMethod":"POST","path":"self-heal","responseMode":"lastNode","options":{}},"id":"webhook","name":"Manual Trigger","type":"n8n-nodes-base.webhook","typeVersion":2,"position":[200,500],"webhookId":"self-heal-webhook"},{"parameters":{"method":"GET","url":"https://garzasync.app.n8n.cloud/api/v1/executions","sendQuery":true,"queryParameters":{"parameters":[{"name":"status","value":"error"},{"name":"limit","value":"10"}]},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"X-N8N-API-KEY","value":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyNTA4NjBiMC00YTYyLTQzZmUtOWFhOC1mNTgwNTg0MDhmMjIiLCJpc3MiOiJuOG4iLCJhdWQiOiJwdWJsaWMtYXBpIiwiaWF0IjoxNzY2NzA2OTg2fQ.QJ8xrSml06-tXP8wTZLh1IGc7JiA-atqpEtPnm5ZNow"}]},"options":{}},"id":"get-errors","name":"Get Failed Executions","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[450,400]},{"parameters":{"jsCode":"return [{json: {\n  id: \"51\",\n  workflowId: \"4r0CRrxxgV133WGP\",\n  status: \"error\",\n  stoppedAt: \"2025-12-26T02:08:36.907Z\"\n}}];"},"id":"filter-new","name":"Filter New Failures","type":"n8n-nodes-base.code","typeVersion":2,"position":[650,400]},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose"},"conditions":[{"id":"check-new","leftValue":"={{ $json.noNewFailures }}","rightValue":true,"operator":{"type":"boolean","operation":"notEquals"}}],"combinator":"and"},"options":{}},"id":"if-new","name":"Has New Failures?","type":"n8n-nodes-base.if","typeVersion":2,"position":[850,400]},{"parameters":{"method":"GET","url":"=https://garzasync.app.n8n.cloud/api/v1/workflows/{{ $json.workflowId }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"X-N8N-API-KEY","value":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyNTA4NjBiMC00YTYyLTQzZmUtOWFhOC1mNTgwNTg0MDhmMjIiLCJpc3MiOiJuOG4iLCJhdWQiOiJwdWJsaWMtYXBpIiwiaWF0IjoxNzY2NzA2OTg2fQ.QJ8xrSml06-tXP8wTZLh1IGc7JiA-atqpEtPnm5ZNow"}]},"options":{}},"id":"get-workflow","name":"Get Workflow JSON","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1050,300]},{"parameters":{"method":"GET","url":"=https://garzasync.app.n8n.cloud/api/v1/executions/{{ $('Filter New Failures').item.json.id }}?includeData=true","sendHeaders":true,"headerParameters":{"parameters":[{"name":"X-N8N-API-KEY","value":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyNTA4NjBiMC00YTYyLTQzZmUtOWFhOC1mNTgwNTg0MDhmMjIiLCJpc3MiOiJuOG4iLCJhdWQiOiJwdWJsaWMtYXBpIiwiaWF0IjoxNzY2NzA2OTg2fQ.QJ8xrSml06-tXP8wTZLh1IGc7JiA-atqpEtPnm5ZNow"}]},"options":{}},"id":"get-execution","name":"Get Execution Details","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1250,300]},{"parameters":{"jsCode":"const workflow = $('Get Workflow JSON').item.json;\nconst execution = $input.first().json;\n\nconst workflowName = workflow.name || 'Unknown';\nconst workflowNodes = workflow.nodes || [];\n\nconst errorData = execution.data?.resultData?.error || {};\nconst errorMessage = errorData.message || 'No error message';\nconst errorNode = errorData.node?.name || 'Unknown node';\nconst errorNodeJson = workflowNodes.find(n => n.name === errorNode);\n\nconst prompt = `You are an n8n workflow debugging expert. Analyze this failure and provide a fix.\n\nWORKFLOW: ${workflowName}\nFAILED NODE: ${errorNode}\nERROR: ${errorMessage}\nNODE JSON: ${JSON.stringify(errorNodeJson, null, 2)}\n\nKNOWN ENDPOINTS:\n- CF MCP: https://mcp-cf.garzahive.com/direct (POST with {\"tool\": \"x\", \"arguments\": {}})\n- Pushcut: https://api.pushcut.io/fRMLJVVtySzvdDoLi93Wh/notifications/garzaos (POST)\n\nRespond in JSON:\n{\n  \"root_cause\": \"brief description\",\n  \"fix_type\": \"config|code|connection|credentials|external\",\n  \"confidence\": 0-100,\n  \"can_auto_fix\": true/false,\n  \"fix_description\": \"what needs to change\",\n  \"node_to_fix\": \"node name or null\",\n  \"fixed_node_parameters\": { parameters to merge, or null }\n}`;\n\nreturn [{\n  json: {\n    apiBody: {\n      model: 'claude-sonnet-4-20250514',\n      max_tokens: 2000,\n      messages: [{ role: 'user', content: prompt }]\n    },\n    workflowName,\n    workflowId: workflow.id,\n    executionId: execution.id,\n    errorNode,\n    errorMessage,\n    errorNodeJson,\n    allNodes: workflowNodes\n  }\n}];"},"id":"build-request","name":"Build Claude Request","type":"n8n-nodes-base.code","typeVersion":2,"position":[1450,300]},{"parameters":{"method":"POST","url":"https://api.anthropic.com/v1/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"x-api-key","value":"{{ANTHROPIC_API_KEY}}"},{"name":"anthropic-version","value":"2023-06-01"},{"name":"content-type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={{ JSON.stringify($json.apiBody) }}","options":{}},"id":"claude-analyze","name":"Claude Analyze Error","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1650,300]},{"parameters":{"jsCode":"const claudeResponse = $input.first().json;\nconst prevData = $('Build Claude Request').item.json;\n\n// Parse Claude's response\nlet analysis = {};\ntry {\n  const content = claudeResponse.content?.[0]?.text || '';\n  // Find JSON in response\n  const jsonMatch = content.match(/\\{[\\s\\S]*\\}/);\n  if (jsonMatch) {\n    analysis = JSON.parse(jsonMatch[0]);\n  }\n} catch(e) {\n  analysis = {\n    root_cause: 'Failed to parse Claude response',\n    fix_type: 'unknown',\n    confidence: 0,\n    can_auto_fix: false,\n    fix_description: e.message\n  };\n}\n\nreturn [{\n  json: {\n    ...analysis,\n    workflowId: prevData.workflowId,\n    workflowName: prevData.workflowName,\n    errorNode: prevData.errorNode,\n    errorMessage: prevData.errorMessage,\n    errorNodeJson: prevData.errorNodeJson,\n    allNodes: prevData.allNodes,\n    executionId: prevData.executionId\n  }\n}];"},"id":"parse-response","name":"Parse Analysis","type":"n8n-nodes-base.code","typeVersion":2,"position":[1850,300]},{"parameters":{"conditions":{"options":{"version":2},"combinator":"and","conditions":[{"id":"auto-fix","leftValue":"={{ $json.can_auto_fix }}","rightValue":true,"operator":{"type":"boolean","operation":"equals"}},{"id":"confidence","leftValue":"={{ $json.confidence }}","rightValue":70,"operator":{"type":"number","operation":"gte"}},{"id":"has-fix","leftValue":"={{ $json.fixed_node_parameters }}","rightValue":"","operator":{"type":"string","operation":"notEquals"}}]},"options":{}},"id":"if-autofix","name":"Can Auto-Fix?","type":"n8n-nodes-base.if","typeVersion":2,"position":[2050,300]},{"parameters":{"method":"POST","url":"https://api.pushcut.io/fRMLJVVtySzvdDoLi93Wh/notifications/garzaos","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={{ JSON.stringify({title: \"âš¡ Self-Heal Applied\", text: $json.workflowName + \": \" + ($json.fix_description || \"Applied fix\"), sound: \"success\"}) }}","options":{}},"id":"notify-autofix","name":"Notify Auto-Fix","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[2250,200]},{"parameters":{"method":"POST","url":"https://api.pushcut.io/fRMLJVVtySzvdDoLi93Wh/notifications/garzaos","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={{ JSON.stringify({title: \"ðŸ” Self-Heal Analysis\", text: $json.workflowName + \": \" + ($json.root_cause || \"Needs review\") + \" (Confidence: \" + $json.confidence + \"%)\", sound: \"alert\"}) }}","options":{}},"id":"notify-manual","name":"Notify Manual Review","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[2250,400]},{"parameters":{"method":"POST","url":"https://api.pushcut.io/fRMLJVVtySzvdDoLi93Wh/notifications/garzaos","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={{ JSON.stringify({title: \"Claude Response\", text: JSON.stringify($json).substring(0, 200)}) }}"},"id":"respond-empty","name":"No New Errors","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1050,500]},{"name":"Apply Fix","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1560,200],"parameters":{"method":"PUT","url":"=https://garzasync.app.n8n.cloud/api/v1/workflows/{{ $json.workflowId }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"X-N8N-API-KEY","value":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyNTA4NjBiMC00YTYyLTQzZmUtOWFhOC1mNTgwNTg0MDhmMjIiLCJpc3MiOiJuOG4iLCJhdWQiOiJwdWJsaWMtYXBpIiwiaWF0IjoxNzY2NzA2OTg2fQ.QJ8xrSml06-tXP8wTZLh1IGc7JiA-atqpEtPnm5ZNow"},{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={{ (() => {\n  const nodes = $json.allNodes || [];\n  const nodeToFix = $json.node_to_fix;\n  const fixParams = $json.fixed_node_parameters || {};\n  \n  const updatedNodes = nodes.map(n => {\n    if (n.name === nodeToFix) {\n      return {...n, parameters: {...n.parameters, ...fixParams}};\n    }\n    return n;\n  });\n  \n  return JSON.stringify({nodes: updatedNodes, name: $json.workflowName, settings: {}});\n})() }}"},"id":"b1fd500f-f7e0-41a2-8444-7c1448e41262"},{"name":"Get Fix History","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[880,300],"parameters":{"method":"POST","url":"https://api.cloudflare.com/client/v4/accounts/14adde85f76060c6edef6f3239d36e6a/d1/database/b09efd12-2be0-4d90-8a7a-dc4fcf16fc85/query","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Bearer 30e198cf037ffd6accc4aa739e6d9b448e23aa67cd4070503eb06c0acb5235be"},{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={{ JSON.stringify({ sql: \"SELECT error_pattern, fix_applied, fix_type, success, created_at FROM self_healing_history WHERE workflow_id = ? ORDER BY created_at DESC LIMIT 5\", params: [$('Get Workflow JSON').item.json.id] }) }}"},"id":"90fc4ee9-3c73-4ff2-aebd-c84962346881"},{"name":"Wait for Execution","type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1680,200],"parameters":{"amount":10,"unit":"seconds"},"id":"f77b38f9-2f6f-40af-b1fa-ed214bb75fe5"},{"name":"Check Fix Result","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1800,200],"parameters":{"method":"GET","url":"=https://garzasync.app.n8n.cloud/api/v1/executions?workflowId={{ $('Parse Analysis').item.json.workflowId }}&limit=1","sendHeaders":true,"headerParameters":{"parameters":[{"name":"X-N8N-API-KEY","value":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyNTA4NjBiMC00YTYyLTQzZmUtOWFhOC1mNTgwNTg0MDhmMjIiLCJpc3MiOiJuOG4iLCJhdWQiOiJwdWJsaWMtYXBpIiwiaWF0IjoxNzY2NzA2OTg2fQ.QJ8xrSml06-tXP8wTZLh1IGc7JiA-atqpEtPnm5ZNow"}]}},"id":"2dfefa10-042b-4232-aa1f-9ced7316b44b"},{"name":"Evaluate Fix","type":"n8n-nodes-base.code","typeVersion":2,"position":[1920,200],"parameters":{"jsCode":"const execResult = $input.first().json;\nconst prevData = $('Parse Analysis').item.json;\nconst latestExec = execResult.data?.[0];\n\nconst fixWorked = latestExec?.status === 'success';\nconst originalNodes = prevData.allNodes;\n\nreturn [{\n  json: {\n    fixWorked,\n    workflowId: prevData.workflowId,\n    workflowName: prevData.workflowName,\n    errorNode: prevData.errorNode,\n    errorPattern: prevData.errorMessage?.substring(0, 200),\n    fixApplied: JSON.stringify(prevData.fixed_node_parameters || {}),\n    fixType: prevData.fix_type,\n    confidence: prevData.confidence,\n    executionBefore: prevData.executionId,\n    executionAfter: latestExec?.id,\n    originalNodes,\n    nodeToFix: prevData.node_to_fix,\n    timestamp: new Date().toISOString()\n  }\n}];"},"id":"d05393e2-515e-48e5-8d4d-813a195269e0"},{"name":"Fix Worked?","type":"n8n-nodes-base.if","typeVersion":2,"position":[2040,200],"parameters":{"conditions":{"options":{"version":2},"combinator":"and","conditions":[{"id":"fix-check","leftValue":"={{ $json.fixWorked }}","rightValue":true,"operator":{"type":"boolean","operation":"equals"}}]}},"id":"ac02d7bc-4255-48ff-a520-db0afdd404fe"},{"name":"Log Success","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[2200,140],"parameters":{"method":"POST","url":"https://api.cloudflare.com/client/v4/accounts/14adde85f76060c6edef6f3239d36e6a/d1/database/b09efd12-2be0-4d90-8a7a-dc4fcf16fc85/query","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Bearer 30e198cf037ffd6accc4aa739e6d9b448e23aa67cd4070503eb06c0acb5235be"},{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={{ JSON.stringify({\n  sql: \"INSERT INTO self_healing_history (workflow_id, workflow_name, error_node, error_pattern, fix_applied, fix_type, confidence, success, execution_before, execution_after) VALUES (?, ?, ?, ?, ?, ?, ?, 1, ?, ?)\",\n  params: [$json.workflowId, $json.workflowName, $json.errorNode, $json.errorPattern, $json.fixApplied, $json.fixType, $json.confidence, $json.executionBefore, $json.executionAfter]\n}) }}"},"id":"fcb8ad2b-78cc-4001-8d4f-92ce197c49cf"},{"name":"Rollback Fix","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[2200,280],"parameters":{"method":"PUT","url":"=https://garzasync.app.n8n.cloud/api/v1/workflows/{{ $json.workflowId }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"X-N8N-API-KEY","value":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyNTA4NjBiMC00YTYyLTQzZmUtOWFhOC1mNTgwNTg0MDhmMjIiLCJpc3MiOiJuOG4iLCJhdWQiOiJwdWJsaWMtYXBpIiwiaWF0IjoxNzY2NzA2OTg2fQ.QJ8xrSml06-tXP8wTZLh1IGc7JiA-atqpEtPnm5ZNow"},{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={{ JSON.stringify({ nodes: $json.originalNodes }) }}"},"id":"131deab9-0f78-4aab-8813-b957e6bedb75"},{"name":"Log Failure","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[2360,280],"parameters":{"method":"POST","url":"https://api.cloudflare.com/client/v4/accounts/14adde85f76060c6edef6f3239d36e6a/d1/database/b09efd12-2be0-4d90-8a7a-dc4fcf16fc85/query","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Bearer 30e198cf037ffd6accc4aa739e6d9b448e23aa67cd4070503eb06c0acb5235be"},{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={{ JSON.stringify({\n  sql: \"INSERT INTO self_healing_history (workflow_id, workflow_name, error_node, error_pattern, fix_applied, fix_type, confidence, success, execution_before, execution_after, rollback_needed) VALUES (?, ?, ?, ?, ?, ?, ?, 0, ?, ?, 1)\",\n  params: [$json.workflowId, $json.workflowName, $json.errorNode, $json.errorPattern, $json.fixApplied, $json.fixType, $json.confidence, $json.executionBefore, $json.executionAfter]\n}) }}"},"id":"eb8eba05-7660-4040-a195-1fab2d9e37fa"},{"name":"Notify Rollback","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[2520,280],"parameters":{"method":"POST","url":"https://api.pushcut.io/fRMLJVVtySzvdDoLi93Wh/notifications/garzaos","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={{ JSON.stringify({\n  title: \"ðŸ”„ Self-Heal ROLLBACK\",\n  text: $json.workflowName + \" fix failed - rolled back. Node: \" + $json.errorNode,\n  sound: \"alert\"\n}) }}"},"id":"305a069e-afef-41b1-a56c-90bd029ba5a2"}],"connections":{"Every 30min":{"main":[[{"node":"Get Failed Executions","type":"main","index":0}]]},"Manual Trigger":{"main":[[{"node":"Get Failed Executions","type":"main","index":0}]]},"Get Failed Executions":{"main":[[{"node":"Filter New Failures","type":"main","index":0}]]},"Filter New Failures":{"main":[[{"node":"Get Workflow JSON","type":"main","index":0}]]},"Has New Failures?":{"main":[[{"node":"Get Workflow JSON","type":"main","index":0}],[{"node":"No New Errors","type":"main","index":0}]]},"Get Workflow JSON":{"main":[[{"node":"Get Execution Details","type":"main","index":0}]]},"Get Execution Details":{"main":[[{"node":"Build Claude Request","type":"main","index":0}]]},"Build Claude Request":{"main":[[{"node":"Claude Analyze Error","type":"main","index":0}]]},"Claude Analyze Error":{"main":[[{"node":"Parse Analysis","type":"main","index":0}]]},"Parse Analysis":{"main":[[{"node":"Can Auto-Fix?","type":"main","index":0}]]},"Can Auto-Fix?":{"main":[[{"node":"Notify Auto-Fix","type":"main","index":0}],[{"node":"Notify Manual Review","type":"main","index":0}]]},"Apply Fix":{"main":[[{"node":"Notify Auto-Fix","type":"main","index":0}]]},"Get Fix History":{"main":[[{"node":"No New Errors","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","availableInMCP":false},"staticData":{"node:Every 30min":{"recurrenceRules":[]},"global":{"lastProcessedIds":["53","52","51","45","41","37","36","33","32","30","28","27","26","25","23","22","21","20","19","18","17"]}},"meta":null,"pinData":null,"versionId":"f6e98878-9535-47fb-9843-7c83fbe39ad7","activeVersionId":"f6e98878-9535-47fb-9843-7c83fbe39ad7","versionCounter":111,"triggerCount":2,"shared":[{"updatedAt":"2025-12-26T00:00:33.303Z","createdAt":"2025-12-26T00:00:33.303Z","role":"workflow:owner","workflowId":"ScSmqCrvcDOkGVjM","projectId":"ZRKSWWwtaPZqyYf5","project":{"updatedAt":"2025-11-03T23:37:11.788Z","createdAt":"2025-11-03T23:37:07.919Z","id":"ZRKSWWwtaPZqyYf5","name":"jaden   <garzasecure@pm.me>","type":"personal","icon":null,"description":null,"creatorId":"250860b0-4a62-43fe-9aa8-f58058408f22","projectRelations":[{"updatedAt":"2025-11-03T23:37:07.920Z","createdAt":"2025-11-03T23:37:07.920Z","userId":"250860b0-4a62-43fe-9aa8-f58058408f22","projectId":"ZRKSWWwtaPZqyYf5","user":{"updatedAt":"2025-12-26T06:00:27.000Z","createdAt":"2025-11-03T23:37:06.499Z","id":"250860b0-4a62-43fe-9aa8-f58058408f22","email":"garzasecure@pm.me","firstName":"jaden","lastName":" ","personalizationAnswers":null,"settings":{"userActivated":true,"firstSuccessfulWorkflowId":"fbeHV6ioUQZwXHfF","userActivatedAt":1766710827089},"disabled":false,"mfaEnabled":false,"lastActiveAt":"2025-12-26","isPending":false}}]}}],"tags":[],"activeVersion":{"updatedAt":"2025-12-26T02:21:24.122Z","createdAt":"2025-12-26T02:21:24.122Z","versionId":"f6e98878-9535-47fb-9843-7c83fbe39ad7","workflowId":"ScSmqCrvcDOkGVjM","nodes":[{"parameters":{"rule":{"interval":[{"field":"minutes","minutesInterval":30}]}},"id":"schedule","name":"Every 30min","type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[200,300]},{"parameters":{"httpMethod":"POST","path":"self-heal","responseMode":"lastNode","options":{}},"id":"webhook","name":"Manual Trigger","type":"n8n-nodes-base.webhook","typeVersion":2,"position":[200,500],"webhookId":"self-heal-webhook"},{"parameters":{"method":"GET","url":"https://garzasync.app.n8n.cloud/api/v1/executions","sendQuery":true,"queryParameters":{"parameters":[{"name":"status","value":"error"},{"name":"limit","value":"10"}]},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"X-N8N-API-KEY","value":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyNTA4NjBiMC00YTYyLTQzZmUtOWFhOC1mNTgwNTg0MDhmMjIiLCJpc3MiOiJuOG4iLCJhdWQiOiJwdWJsaWMtYXBpIiwiaWF0IjoxNzY2NzA2OTg2fQ.QJ8xrSml06-tXP8wTZLh1IGc7JiA-atqpEtPnm5ZNow"}]},"options":{}},"id":"get-errors","name":"Get Failed Executions","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[450,400]},{"parameters":{"jsCode":"return [{json: {\n  id: \"51\",\n  workflowId: \"4r0CRrxxgV133WGP\",\n  status: \"error\",\n  stoppedAt: \"2025-12-26T02:08:36.907Z\"\n}}];"},"id":"filter-new","name":"Filter New Failures","type":"n8n-nodes-base.code","typeVersion":2,"position":[650,400]},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose"},"conditions":[{"id":"check-new","leftValue":"={{ $json.noNewFailures }}","rightValue":true,"operator":{"type":"boolean","operation":"notEquals"}}],"combinator":"and"},"options":{}},"id":"if-new","name":"Has New Failures?","type":"n8n-nodes-base.if","typeVersion":2,"position":[850,400]},{"parameters":{"method":"GET","url":"=https://garzasync.app.n8n.cloud/api/v1/workflows/{{ $json.workflowId }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"X-N8N-API-KEY","value":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyNTA4NjBiMC00YTYyLTQzZmUtOWFhOC1mNTgwNTg0MDhmMjIiLCJpc3MiOiJuOG4iLCJhdWQiOiJwdWJsaWMtYXBpIiwiaWF0IjoxNzY2NzA2OTg2fQ.QJ8xrSml06-tXP8wTZLh1IGc7JiA-atqpEtPnm5ZNow"}]},"options":{}},"id":"get-workflow","name":"Get Workflow JSON","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1050,300]},{"parameters":{"method":"GET","url":"=https://garzasync.app.n8n.cloud/api/v1/executions/{{ $('Filter New Failures').item.json.id }}?includeData=true","sendHeaders":true,"headerParameters":{"parameters":[{"name":"X-N8N-API-KEY","value":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyNTA4NjBiMC00YTYyLTQzZmUtOWFhOC1mNTgwNTg0MDhmMjIiLCJpc3MiOiJuOG4iLCJhdWQiOiJwdWJsaWMtYXBpIiwiaWF0IjoxNzY2NzA2OTg2fQ.QJ8xrSml06-tXP8wTZLh1IGc7JiA-atqpEtPnm5ZNow"}]},"options":{}},"id":"get-execution","name":"Get Execution Details","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1250,300]},{"parameters":{"jsCode":"const workflow = $('Get Workflow JSON').item.json;\nconst execution = $input.first().json;\n\nconst workflowName = workflow.name || 'Unknown';\nconst workflowNodes = workflow.nodes || [];\n\nconst errorData = execution.data?.resultData?.error || {};\nconst errorMessage = errorData.message || 'No error message';\nconst errorNode = errorData.node?.name || 'Unknown node';\nconst errorNodeJson = workflowNodes.find(n => n.name === errorNode);\n\nconst prompt = `You are an n8n workflow debugging expert. Analyze this failure and provide a fix.\n\nWORKFLOW: ${workflowName}\nFAILED NODE: ${errorNode}\nERROR: ${errorMessage}\nNODE JSON: ${JSON.stringify(errorNodeJson, null, 2)}\n\nKNOWN ENDPOINTS:\n- CF MCP: https://mcp-cf.garzahive.com/direct (POST with {\"tool\": \"x\", \"arguments\": {}})\n- Pushcut: https://api.pushcut.io/fRMLJVVtySzvdDoLi93Wh/notifications/garzaos (POST)\n\nRespond in JSON:\n{\n  \"root_cause\": \"brief description\",\n  \"fix_type\": \"config|code|connection|credentials|external\",\n  \"confidence\": 0-100,\n  \"can_auto_fix\": true/false,\n  \"fix_description\": \"what needs to change\",\n  \"node_to_fix\": \"node name or null\",\n  \"fixed_node_parameters\": { parameters to merge, or null }\n}`;\n\nreturn [{\n  json: {\n    apiBody: {\n      model: 'claude-sonnet-4-20250514',\n      max_tokens: 2000,\n      messages: [{ role: 'user', content: prompt }]\n    },\n    workflowName,\n    workflowId: workflow.id,\n    executionId: execution.id,\n    errorNode,\n    errorMessage,\n    errorNodeJson,\n    allNodes: workflowNodes\n  }\n}];"},"id":"build-request","name":"Build Claude Request","type":"n8n-nodes-base.code","typeVersion":2,"position":[1450,300]},{"parameters":{"method":"POST","url":"https://api.anthropic.com/v1/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"x-api-key","value":"{{ANTHROPIC_API_KEY}}"},{"name":"anthropic-version","value":"2023-06-01"},{"name":"content-type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={{ JSON.stringify($json.apiBody) }}","options":{}},"id":"claude-analyze","name":"Claude Analyze Error","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1650,300]},{"parameters":{"jsCode":"const claudeResponse = $input.first().json;\nconst prevData = $('Build Claude Request').item.json;\n\n// Parse Claude's response\nlet analysis = {};\ntry {\n  const content = claudeResponse.content?.[0]?.text || '';\n  // Find JSON in response\n  const jsonMatch = content.match(/\\{[\\s\\S]*\\}/);\n  if (jsonMatch) {\n    analysis = JSON.parse(jsonMatch[0]);\n  }\n} catch(e) {\n  analysis = {\n    root_cause: 'Failed to parse Claude response',\n    fix_type: 'unknown',\n    confidence: 0,\n    can_auto_fix: false,\n    fix_description: e.message\n  };\n}\n\nreturn [{\n  json: {\n    ...analysis,\n    workflowId: prevData.workflowId,\n    workflowName: prevData.workflowName,\n    errorNode: prevData.errorNode,\n    errorMessage: prevData.errorMessage,\n    errorNodeJson: prevData.errorNodeJson,\n    allNodes: prevData.allNodes,\n    executionId: prevData.executionId\n  }\n}];"},"id":"parse-response","name":"Parse Analysis","type":"n8n-nodes-base.code","typeVersion":2,"position":[1850,300]},{"parameters":{"conditions":{"options":{"version":2},"combinator":"and","conditions":[{"id":"auto-fix","leftValue":"={{ $json.can_auto_fix }}","rightValue":true,"operator":{"type":"boolean","operation":"equals"}},{"id":"confidence","leftValue":"={{ $json.confidence }}","rightValue":70,"operator":{"type":"number","operation":"gte"}},{"id":"has-fix","leftValue":"={{ $json.fixed_node_parameters }}","rightValue":"","operator":{"type":"string","operation":"notEquals"}}]},"options":{}},"id":"if-autofix","name":"Can Auto-Fix?","type":"n8n-nodes-base.if","typeVersion":2,"position":[2050,300]},{"parameters":{"method":"POST","url":"https://api.pushcut.io/fRMLJVVtySzvdDoLi93Wh/notifications/garzaos","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={{ JSON.stringify({title: \"âš¡ Self-Heal Applied\", text: $json.workflowName + \": \" + ($json.fix_description || \"Applied fix\"), sound: \"success\"}) }}","options":{}},"id":"notify-autofix","name":"Notify Auto-Fix","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[2250,200]},{"parameters":{"method":"POST","url":"https://api.pushcut.io/fRMLJVVtySzvdDoLi93Wh/notifications/garzaos","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={{ JSON.stringify({title: \"ðŸ” Self-Heal Analysis\", text: $json.workflowName + \": \" + ($json.root_cause || \"Needs review\") + \" (Confidence: \" + $json.confidence + \"%)\", sound: \"alert\"}) }}","options":{}},"id":"notify-manual","name":"Notify Manual Review","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[2250,400]},{"parameters":{"method":"POST","url":"https://api.pushcut.io/fRMLJVVtySzvdDoLi93Wh/notifications/garzaos","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={{ JSON.stringify({title: \"Claude Response\", text: JSON.stringify($json).substring(0, 200)}) }}"},"id":"respond-empty","name":"No New Errors","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1050,500]},{"name":"Apply Fix","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1560,200],"parameters":{"method":"PUT","url":"=https://garzasync.app.n8n.cloud/api/v1/workflows/{{ $json.workflowId }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"X-N8N-API-KEY","value":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyNTA4NjBiMC00YTYyLTQzZmUtOWFhOC1mNTgwNTg0MDhmMjIiLCJpc3MiOiJuOG4iLCJhdWQiOiJwdWJsaWMtYXBpIiwiaWF0IjoxNzY2NzA2OTg2fQ.QJ8xrSml06-tXP8wTZLh1IGc7JiA-atqpEtPnm5ZNow"},{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={{ (() => {\n  const nodes = $json.allNodes || [];\n  const nodeToFix = $json.node_to_fix;\n  const fixParams = $json.fixed_node_parameters || {};\n  \n  const updatedNodes = nodes.map(n => {\n    if (n.name === nodeToFix) {\n      return {...n, parameters: {...n.parameters, ...fixParams}};\n    }\n    return n;\n  });\n  \n  return JSON.stringify({nodes: updatedNodes, name: $json.workflowName, settings: {}});\n})() }}"},"id":"b1fd500f-f7e0-41a2-8444-7c1448e41262"},{"name":"Get Fix History","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[880,300],"parameters":{"method":"POST","url":"https://api.cloudflare.com/client/v4/accounts/14adde85f76060c6edef6f3239d36e6a/d1/database/b09efd12-2be0-4d90-8a7a-dc4fcf16fc85/query","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Bearer 30e198cf037ffd6accc4aa739e6d9b448e23aa67cd4070503eb06c0acb5235be"},{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={{ JSON.stringify({ sql: \"SELECT error_pattern, fix_applied, fix_type, success, created_at FROM self_healing_history WHERE workflow_id = ? ORDER BY created_at DESC LIMIT 5\", params: [$('Get Workflow JSON').item.json.id] }) }}"},"id":"90fc4ee9-3c73-4ff2-aebd-c84962346881"},{"name":"Wait for Execution","type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1680,200],"parameters":{"amount":10,"unit":"seconds"},"id":"f77b38f9-2f6f-40af-b1fa-ed214bb75fe5"},{"name":"Check Fix Result","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1800,200],"parameters":{"method":"GET","url":"=https://garzasync.app.n8n.cloud/api/v1/executions?workflowId={{ $('Parse Analysis').item.json.workflowId }}&limit=1","sendHeaders":true,"headerParameters":{"parameters":[{"name":"X-N8N-API-KEY","value":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyNTA4NjBiMC00YTYyLTQzZmUtOWFhOC1mNTgwNTg0MDhmMjIiLCJpc3MiOiJuOG4iLCJhdWQiOiJwdWJsaWMtYXBpIiwiaWF0IjoxNzY2NzA2OTg2fQ.QJ8xrSml06-tXP8wTZLh1IGc7JiA-atqpEtPnm5ZNow"}]}},"id":"2dfefa10-042b-4232-aa1f-9ced7316b44b"},{"name":"Evaluate Fix","type":"n8n-nodes-base.code","typeVersion":2,"position":[1920,200],"parameters":{"jsCode":"const execResult = $input.first().json;\nconst prevData = $('Parse Analysis').item.json;\nconst latestExec = execResult.data?.[0];\n\nconst fixWorked = latestExec?.status === 'success';\nconst originalNodes = prevData.allNodes;\n\nreturn [{\n  json: {\n    fixWorked,\n    workflowId: prevData.workflowId,\n    workflowName: prevData.workflowName,\n    errorNode: prevData.errorNode,\n    errorPattern: prevData.errorMessage?.substring(0, 200),\n    fixApplied: JSON.stringify(prevData.fixed_node_parameters || {}),\n    fixType: prevData.fix_type,\n    confidence: prevData.confidence,\n    executionBefore: prevData.executionId,\n    executionAfter: latestExec?.id,\n    originalNodes,\n    nodeToFix: prevData.node_to_fix,\n    timestamp: new Date().toISOString()\n  }\n}];"},"id":"d05393e2-515e-48e5-8d4d-813a195269e0"},{"name":"Fix Worked?","type":"n8n-nodes-base.if","typeVersion":2,"position":[2040,200],"parameters":{"conditions":{"options":{"version":2},"combinator":"and","conditions":[{"id":"fix-check","leftValue":"={{ $json.fixWorked }}","rightValue":true,"operator":{"type":"boolean","operation":"equals"}}]}},"id":"ac02d7bc-4255-48ff-a520-db0afdd404fe"},{"name":"Log Success","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[2200,140],"parameters":{"method":"POST","url":"https://api.cloudflare.com/client/v4/accounts/14adde85f76060c6edef6f3239d36e6a/d1/database/b09efd12-2be0-4d90-8a7a-dc4fcf16fc85/query","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Bearer 30e198cf037ffd6accc4aa739e6d9b448e23aa67cd4070503eb06c0acb5235be"},{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={{ JSON.stringify({\n  sql: \"INSERT INTO self_healing_history (workflow_id, workflow_name, error_node, error_pattern, fix_applied, fix_type, confidence, success, execution_before, execution_after) VALUES (?, ?, ?, ?, ?, ?, ?, 1, ?, ?)\",\n  params: [$json.workflowId, $json.workflowName, $json.errorNode, $json.errorPattern, $json.fixApplied, $json.fixType, $json.confidence, $json.executionBefore, $json.executionAfter]\n}) }}"},"id":"fcb8ad2b-78cc-4001-8d4f-92ce197c49cf"},{"name":"Rollback Fix","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[2200,280],"parameters":{"method":"PUT","url":"=https://garzasync.app.n8n.cloud/api/v1/workflows/{{ $json.workflowId }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"X-N8N-API-KEY","value":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyNTA4NjBiMC00YTYyLTQzZmUtOWFhOC1mNTgwNTg0MDhmMjIiLCJpc3MiOiJuOG4iLCJhdWQiOiJwdWJsaWMtYXBpIiwiaWF0IjoxNzY2NzA2OTg2fQ.QJ8xrSml06-tXP8wTZLh1IGc7JiA-atqpEtPnm5ZNow"},{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={{ JSON.stringify({ nodes: $json.originalNodes }) }}"},"id":"131deab9-0f78-4aab-8813-b957e6bedb75"},{"name":"Log Failure","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[2360,280],"parameters":{"method":"POST","url":"https://api.cloudflare.com/client/v4/accounts/14adde85f76060c6edef6f3239d36e6a/d1/database/b09efd12-2be0-4d90-8a7a-dc4fcf16fc85/query","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Bearer 30e198cf037ffd6accc4aa739e6d9b448e23aa67cd4070503eb06c0acb5235be"},{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={{ JSON.stringify({\n  sql: \"INSERT INTO self_healing_history (workflow_id, workflow_name, error_node, error_pattern, fix_applied, fix_type, confidence, success, execution_before, execution_after, rollback_needed) VALUES (?, ?, ?, ?, ?, ?, ?, 0, ?, ?, 1)\",\n  params: [$json.workflowId, $json.workflowName, $json.errorNode, $json.errorPattern, $json.fixApplied, $json.fixType, $json.confidence, $json.executionBefore, $json.executionAfter]\n}) }}"},"id":"eb8eba05-7660-4040-a195-1fab2d9e37fa"},{"name":"Notify Rollback","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[2520,280],"parameters":{"method":"POST","url":"https://api.pushcut.io/fRMLJVVtySzvdDoLi93Wh/notifications/garzaos","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={{ JSON.stringify({\n  title: \"ðŸ”„ Self-Heal ROLLBACK\",\n  text: $json.workflowName + \" fix failed - rolled back. Node: \" + $json.errorNode,\n  sound: \"alert\"\n}) }}"},"id":"305a069e-afef-41b1-a56c-90bd029ba5a2"}],"connections":{"Every 30min":{"main":[[{"node":"Get Failed Executions","type":"main","index":0}]]},"Manual Trigger":{"main":[[{"node":"Get Failed Executions","type":"main","index":0}]]},"Get Failed Executions":{"main":[[{"node":"Filter New Failures","type":"main","index":0}]]},"Filter New Failures":{"main":[[{"node":"Get Workflow JSON","type":"main","index":0}]]},"Has New Failures?":{"main":[[{"node":"Get Workflow JSON","type":"main","index":0}],[{"node":"No New Errors","type":"main","index":0}]]},"Get Workflow JSON":{"main":[[{"node":"Get Execution Details","type":"main","index":0}]]},"Get Execution Details":{"main":[[{"node":"Build Claude Request","type":"main","index":0}]]},"Build Claude Request":{"main":[[{"node":"Claude Analyze Error","type":"main","index":0}]]},"Claude Analyze Error":{"main":[[{"node":"Parse Analysis","type":"main","index":0}]]},"Parse Analysis":{"main":[[{"node":"Can Auto-Fix?","type":"main","index":0}]]},"Can Auto-Fix?":{"main":[[{"node":"Notify Auto-Fix","type":"main","index":0}],[{"node":"Notify Manual Review","type":"main","index":0}]]},"Apply Fix":{"main":[[{"node":"Notify Auto-Fix","type":"main","index":0}]]},"Get Fix History":{"main":[[{"node":"No New Errors","type":"main","index":0}]]}},"authors":"jaden  ","name":null,"description":null,"autosaved":false,"workflowPublishHistory":[{"createdAt":"2025-12-26T02:21:24.304Z","id":66,"workflowId":"ScSmqCrvcDOkGVjM","versionId":"f6e98878-9535-47fb-9843-7c83fbe39ad7","event":"activated","userId":"250860b0-4a62-43fe-9aa8-f58058408f22"}]}}